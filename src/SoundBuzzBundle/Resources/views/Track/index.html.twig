{% extends "SoundBuzzBundle:Default:layout.html.twig" %}
{% block title %}
    SoundBuzz - Mes Musiques
{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ asset('css/track.css')}}">
{%  endblock %}
{% block body %}
    <h2 class="titretrack">Mes musiques </h2>
    <div class="addTracks"><a href="{{ path('track_new') }}">Ajouter un nouveau morceau</a></div>
    <div class="table-list">
        <table class="table-tracks">
            <thead>
                <tr>
                    <th></th>
                    <th>Titre</th>
                    <th>Extension</th>
                    <th class="displayTD">Description</th>
                    {#<th>Urlpicture</th>#}
                    <th>Compositeur</th>
                    <th>Duration</th>
                    <th class="displayTD">Nb. écoute</th>
                    <th class="displayTD">Nb. téléchargement</th>
                    <th class="displayTD">Nb. vues</th>
                    <th class="displayTD">Nb. likes</th>
                    <th class="displayTD">Player</th>
                    {#<th>Updatedat</th>
                    <th>Createdat</th>
                    <th>Nbcomments</th>
                    <th>Isvalidated</th>#}
                    <th>Actions</th>
                    {#
                    <th>Explicitcontent</th>
                    <th>Downloadauthorization</th>
                    <th>Transferredat</th>#}
                </tr>
            </thead>
            <tbody>
            {% for track in tracks %}
                <tr>
                    <td><img src="{{ asset('uploads/pictures/') }}{{user.id}}/{{ track.urlPicture }}" alt="{{ track.title }}" title="{{ track.title }}" /> </td>
                    <td><a href="{{ path('track_information', {'id': track.id}) }}"> {{ track.title }}</a></td>
                    <td>{{ track.extension }}</td>
                    <td class="displayTD">{{ track.description }}</td>
                    <td>{{ track.compositor }}</td>
                    {#<td>{% if track.explicitContent %}Yes{% else %}No{% endif %}</td>
                    <td>{% if track.downloadAuthorization %}Yes{% else %}No{% endif %}</td>
                    <td>{% if track.transferredAt %}{{ track.transferredAt|date('Y-m-d H:i:s') }}{% endif %}</td>#}
                    <td>{{ track.duration }}</td>
                    <td class="displayTD">{{ track.nbListenings }}</td>
                    <td class="displayTD">{{ track.nbDownloads }}</td>
                    <td class="displayTD">{{ track.nbViews }}</td>
                    <td class="displayTD">{{ track.nbLikes }}</td>
                    {#<td>{% if track.updatedAt %}{{ track.updatedAt|date('Y-m-d H:i:s') }}{% endif %}</td>
                    <td>{% if track.createdAt %}{{ track.createdAt|date('Y-m-d H:i:s') }}{% endif %}</td>
                    <td>{{ track.nbComments }}</td>#}
                    <td>
                    <span class="playTrack" data-src="{{ asset('uploads/tracks/') }}{{user.id}}/{{ track.urlTrack }}">toto</span>
                        {# <audio class="track" id="track_{{track.id}}" controls src="{{ asset('uploads/tracks/') }}{{user.id}}/{{ track.urlTrack }}" controlsList="nodownload">
                            Your browser does not support the <code>audio</code> element.
                        </audio> #}
                    </td>
                    {# <td>{% if track.isValidated %}Yes{% else %}No{% endif %}</td> #}
                    <td>
                        <ul>
                            <li>
                              <a href="{{ path('track_delete', { 'id': track.id }) }}">Supprimer</a>
                            </li>
                            <li>
                                <a href="{{ path('track_edit', { 'id': track.id }) }}">Modifier</a>
                            </li>
                            <li>
                                <a href="{{ asset('uploads/tracks/') }}{{user.id}}/{{ track.urlTrack }}" download>Télécharger</a>
                            </li>
                        </ul>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        {# var element = document.getElementById("track_13");
        element.addEventListener("play", function(elem) {
            console.log('test');
            var timer = setInterval(()=>{
                if(elem.target.currentTime > 10){
                    alert("update");
                }
                else{
                    clearInterval(timer);
                }
            },1000);

        }, true); #}
        {# element = document.getElementById(superId);

        var timer;
        var updated = 0;
        element.addEventListener("play", function() {
            timer = setInterval(()=>{
                if(element.currentTime > 10 && updated == 0){
                    alert("update");
                    updated = 1;
                }
            },1000);

            timer();
        }, true);
            
        element.addEventListener("pause", function() {
            clearInterval(timer);
        }, true); #}
    </script>
{% endblock %}
